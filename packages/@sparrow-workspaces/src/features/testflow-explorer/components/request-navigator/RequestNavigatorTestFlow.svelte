<script lang="ts">
  import { type UpdateRequestStateType } from "@sparrow/workspaces/type";
  import {
    RequestSectionEnum,
    ResponseSectionEnum,
  } from "@sparrow/common/types/workspace";
  import { onMount } from "svelte";
  import { Navigator } from "@sparrow/library/ui";
  export let authParameterLength = 0;
  export let authHeaderLength = 0;
  export let paramsLength = 0;
  export let headersLength = 0;
  export let autoGeneratedHeadersLength = 0;

  export let updateActiveTabInsideRequestBody;

  export let requestNavigation;

  let tabs: {
    name: string;
    id: RequestSectionEnum;
    count: number;
  }[] = [];

  /**
   * @description - refresh tabs label count
   * @param _paramsLength - query parameter length
   * @param _authParameterLength - auth parameter length
   * @param _headersLength - headers length
   * @param _autoGeneratedHeadersLength - auto generated headers length
   * @param _authHeaderLength - auth headers length
   */
  const refreshTabs = (
    _paramsLength: number,
    _authParameterLength: number,
    _headersLength: number,
    _autoGeneratedHeadersLength: number,
    _authHeaderLength: number,
  ) => {
    return [
      { name: "Body", id: RequestSectionEnum.REQUEST_BODY, count: 0 },
      {
        name: "Parameters",
        id: RequestSectionEnum.PARAMETERS,
        count: _paramsLength + _authParameterLength - 1,
      },
      {
        name: "Headers",
        id: RequestSectionEnum.HEADERS,
        count:
          _headersLength + _autoGeneratedHeadersLength + _authHeaderLength - 1,
      },
    ];
  };

  onMount(() => {
    tabs = refreshTabs(
      paramsLength,
      authParameterLength,
      headersLength,
      autoGeneratedHeadersLength,
      authHeaderLength,
    );
  });

  /**
   * @description - re-calculates value when dependency changes
   */
  $: {
    if (
      authParameterLength ||
      authHeaderLength ||
      paramsLength ||
      headersLength ||
      autoGeneratedHeadersLength
    ) {
      tabs = refreshTabs(
        paramsLength,
        authParameterLength,
        headersLength,
        autoGeneratedHeadersLength,
        authHeaderLength,
      );
    }
  }

  const onTabClick = (tabId: ResponseSectionEnum) => {
    updateActiveTabInsideRequestBody(tabId);
  };
</script>

<div style="position: relative;">
  <Navigator {tabs} {onTabClick} currentTabId={requestNavigation} />
</div>
