# File: .github/workflows/sparrow-app-test-pipeline.yml
# This file is used to test the Sparrow App build and release process.
# It verifies that the SNAPCRAFT_STORE_CREDENTIALS secret from the PRODUCTION environment is available.

name: Test release

on:
  push:
    branches:
      - <branch_name>  # replace with your test branch
  workflow_dispatch:

env:
  # Using the secret from the production environment
  SNAPCRAFT_STORE_CREDENTIALS: ${{ secrets.SNAPCRAFT_STORE_CREDENTIALS }}

jobs:
  test-snap-secret:
    runs-on: ubuntu-latest
    environment: production   # This ensures the job accesses secrets from the production environment
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Validate Snapcraft Secret
        run: |
          if [ -z "$SNAPCRAFT_STORE_CREDENTIALS" ]; then
            echo "::error::SNAPCRAFT_STORE_CREDENTIALS is empty"
            exit 1
          fi
          echo "Secret is set. First 10 chars: ${SNAPCRAFT_STORE_CREDENTIALS:0:10}..."
